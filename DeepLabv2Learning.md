# 学习论文[DeepLabv2:Semantic Image Segmentation with Deep Convolutional Nets, Atrous Convolution, and Fully Connected CRFs](https://arxiv.org/pdf/1606.00915.pdf)

## 摘要&介绍

### 1 三个贡献

#### (1) 空洞卷积

- 控制特征图的分辨率
- 不增加参数的前提下扩大过滤器的接受野，包含更大的上下文

#### (2) 空洞空间金字塔池化(ASPP:Atrous Spatial Pyramid Pooling)

- 多尺度分割
- ASPP用过滤器以多种采样率和有效的视野探测卷积特征层，捕获不同尺度的目标和图像上下文

#### (3) 结合DCNN和CRF来改进对象边界的定位

### 2 将DCNN应用到语义分割的三个困难&解决方法

#### (1) 下采样导致特征图的分辨率降低（DeepLabv1中提到）

- 在DeepLabv1中
  - 在最后的两个最大池化层中**去掉下采样**
  - 在<u>之后的卷积层</u>中，保持过滤器不变，**对特征图进行稀疏采样**（空洞卷积的一种实现方式）
- 本文
  - 在最后的几个最大池化层中**去掉下采样**
  - 在它<u>之后的卷积层</u>中**对滤波器进行上采样**（空洞卷积的另一种实现方式），在卷积核中填充0

#### (2) 多尺度分割目标的存在

- 标准方法
  - 将**图像不同缩放**版本后交给DCNN，之后整合特征图/分数图
  - 缺点：计算量大
  
- 基于**空间金字塔池化(SPP)**（采用）
  
  - **空间金字塔池化**
    
    - 在卷积层和全连接层之间增加空间金字塔池化层
    - 输入不同大小的图像，都会输出21维（固定大小）特征，输入全连接层
    
    <img src=".\Figures\DeepLabv2\SPP.JPG" style="zoom:67%;" />
    
  - 提出：在卷积之前以<u>不同的采样率</u>**重新采样特征**，对不同尺度的图像采用不同的过滤器
  
  - 本文实现：**ASPP(空洞空间金字塔池化)**
  
    - 并非真的对特征进行重采样
    - 使用不同的并行的**具有不同的采样率的<u>空洞卷积层</u>**

#### (3) DCNN空间变换的不变性降低定位精度（DeepLabv1提到）

- 一种方法
  - 使用跳跃连接（像FCN）
- **全连接的CRF**（采用）
  - 使用CRF来增强捕获细节的能力
    - CRF已经广泛应用到语义分割：将多路分类器输出的**类别分数图和低级信息结合**
  - 使用**全连接的二元CRF**
    - 优点：很好的捕获边缘细节，适合长范围的依赖

### 3 DeepLab模型（DeepLabv1提到）

![](.\Figures\DeepLabv2\deeplab_model.JPG)

- 将全连接层转换为卷积层
- 通过空洞卷积层增大接受野（因为将最后两个下采样去掉了，图像缩小到1/8，非1/32，图像较大，见DeepLabv1）
- 通过简单的双线性插值（8x，扩大到原图像大小）
- 输入全连接CRF提高定位精度

### 4 DeepLabv2 vs DeepLabv1

- 更好的分割不同尺度的图像
  - 通过扩展Caffe框架，实现ASPP
- 对多种模型变体进行更全面的评估



## 方法

### 1 空洞卷积——用于提取密集特征&扩大接受野

#### (1) 一维

![](.\Figures\DeepLabv2\atrous_convolution.JPG)

- 表达式
  $$
  y[i]=\sum_{k=1}^Kx[i+r\cdot k]w[k]\\
  其中，r为步长
  $$
  

#### (2) 二维

- 对过滤器进行**上采样**

  - 不同于DeepLabv1（保持卷积核不变，以不同的输入步长对输入的特征图进行稀疏采样）
  - 这里的空洞卷积是通过在卷积核中填充0值来实现（如上图b）：k x k -> (k+(r-1)(k-1)) x (k+(r-1)(k-1))
  - 虽然增大了过滤器的大小，但是只需要考虑非零的值，所以过滤器的参数没有增加

- 直接在高分辨率的图像上进行密集特征提取（如下图下行）

  - DeepLabv1中提到去掉网络中最后两个最大池化层中的下采样，则输出的图像是原图像的1/8，分辨率高
  - 在之后直接对高分辨率图像（1/8）进行空洞卷积比下采样后卷积再上采样（如下图上行，FCN）效果好很多

  ![](.\Figures\DeepLabv2\atrous_convolution_2D.JPG)

### 2 ASPP——用于多尺度图像

​	使用了两种方法进行实验

#### (1) 标准的多尺度处理

- 从原图像的不同缩放版本（三个）中提取分数图/特征图
  - 使用并行的DCNN分支
- 将DCNN不同分支输出的不同尺度的特征图**恢复到原图像的大小**，并**融合**
  - 放大特征图：使用双线性插值
  - 融合：不同特征图中获取每个位置上最大响应

#### (2) ASPP：空洞空间金字塔池化

- 空间金字塔池化：

  - 对卷积后的特征图进行重采样，输出为同一尺度（21维）

- ASPP：

  - 使用并行的多个（下图有4个）空洞卷积层（不同的采样率）
  - 提取到的特征图之后会经过不同的分支进一步处理，并融合产生最后的结果

  <img src=".\Figures\DeepLabv2\ASPP.JPG" style="zoom:67%;" />

### 3 全连接CRF——用于恢复精确的边界